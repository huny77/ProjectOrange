image: docker:latest

services:
  - docker:dind

stages:
  - test
  - deploy

test:
    stage: test
    only:
        - develop
        - master
    script:
        - echo run tests in this section
deploy:
    stage: deploy
    only:
        - develop
        - master
    script:
        - sudo apt-get install -y python-pip
        - sudo pip install docker-compose
        - sudo docker image prune -f
        - sudo docker-compose -f docker-compose.yml build --no-cache
        - sudo docker-compose -f docker-compose.yml up -d
    environment: master
    when: manual
